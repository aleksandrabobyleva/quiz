<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8" />
    <title>Баллы</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #cfcfcf21;
        }

        h2 {
            text-align: center;
        }

        table {
            margin: 0 auto;
            border-collapse: collapse;
            width: 90%;
            max-width: 700px;
            background: white;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
            
           
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
             border-radius: 18px;
        }

        input[type="text"] {
            width: 95%;
            padding: 6px;
            font-size: 1rem;
            box-sizing: border-box;
        }

        input[type="number"] {
            width: 70px;
            padding: 6px;
            font-size: 1rem;
            text-align: center;
        }

        .total {
            font-weight: bold;
            color: #b22222;
        }
    </style>
</head>

<body>
    <h2>Баллы</h2>
    <table id="scoreTable">
        <thead>
            <tr>
                <th>Команда</th>
                <th>Case №1</th>
                <th>Case №2</th>
                <th>Cipher</th>
                <th>Итого</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

  <script>
    const defaultTeams = [
      { name: "Team 1", case1: 0, case2: 0, cipher: 0 },
      { name: "Team 2", case1: 0, case2: 0, cipher: 0 },
    ];

    async function loadData() {
      try {
        const res = await fetch("https://quiz-58oj.onrender.com/teams");
        if (res.ok) return await res.json();
      } catch (e) {
        console.error(e);
      }
      return defaultTeams;
    }

    async function saveData(data) {
      try {
        await fetch("https://quiz-58oj.onrender.com/teams", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });
      } catch (e) {
        console.error(e);
      }
    }

    function updateTotal(row, data) {
      const totalCell = row.querySelector(".total");
      const total = Number(data.case1) + Number(data.case2) + Number(data.cipher);
      totalCell.textContent = total;
    }

    async function renderTable() {
      const tbody = document.querySelector("#scoreTable tbody");
      tbody.innerHTML = "";
      const teams = await loadData();

      teams.forEach((team, index) => {
        const tr = document.createElement("tr");

        // Название команды
        const tdName = document.createElement("td");
        const inputName = document.createElement("input");
        inputName.type = "text";
        inputName.value = team.name;
        inputName.addEventListener("input", (e) => {
          teams[index].name = e.target.value;
          saveData(teams);
        });
        tdName.appendChild(inputName);
        tr.appendChild(tdName);

        // Баллы
        ["case1", "case2", "cipher"].forEach((key) => {
          const td = document.createElement("td");
          const inputNum = document.createElement("input");
          inputNum.type = "number";
          inputNum.min = "0";
          inputNum.value = team[key];
          inputNum.addEventListener("input", (e) => {
            const val = e.target.value;
            teams[index][key] = val === "" ? 0 : Number(val);
            updateTotal(tr, teams[index]);
            saveData(teams);
          });
          td.appendChild(inputNum);
          tr.appendChild(td);
        });

        // Итог
        const tdTotal = document.createElement("td");
        tdTotal.className = "total";
        tdTotal.textContent =
          Number(team.case1) + Number(team.case2) + Number(team.cipher);
        tr.appendChild(tdTotal);

        tbody.appendChild(tr);
      });
    }

    window.addEventListener("DOMContentLoaded", renderTable);
  </script>
</body>

</html>